"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.adaptResponse = adaptResponse;

var _slicedToArray2 = _interopRequireDefault(require("@babel/runtime/helpers/slicedToArray"));

var _defineProperty2 = _interopRequireDefault(require("@babel/runtime/helpers/defineProperty"));

var _objectWithoutProperties2 = _interopRequireDefault(require("@babel/runtime/helpers/objectWithoutProperties"));

function ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }

function _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { (0, _defineProperty2.default)(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }

function adaptation1AdaptFacetValue(facetValue) {
  var additionalFacetValueFieldsForField = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};
  var hasValue = facetValue.hasOwnProperty("value");
  var count = facetValue.count,
      value = facetValue.value,
      rest = (0, _objectWithoutProperties2.default)(facetValue, ["count", "value"]);
  return {
    count: count,
    value: hasValue ? value : _objectSpread(_objectSpread({}, rest), additionalFacetValueFieldsForField)
  };
}

function adaptation2AddLabelToFacet(fieldName, facet) {
  return _objectSpread({
    field: fieldName
  }, facet);
}

function adaptFacets(facets, _ref) {
  var _ref$additionalFacetV = _ref.additionalFacetValueFields,
      additionalFacetValueFields = _ref$additionalFacetV === void 0 ? {} : _ref$additionalFacetV;
  if (!facets || Object.keys(facets).length === 0) return facets;
  return Object.entries(facets).reduce(function (acc, _ref2) {
    var _ref3 = (0, _slicedToArray2.default)(_ref2, 2),
        fieldName = _ref3[0],
        facet = _ref3[1];

    var adaptedFacet = facet.map(function (v) {
      var type = v.type,
          data = v.data,
          rest = (0, _objectWithoutProperties2.default)(v, ["type", "data"]);
      return adaptation2AddLabelToFacet(fieldName, _objectSpread({
        type: type,
        data: data.map(function (f) {
          return adaptation1AdaptFacetValue(f, additionalFacetValueFields[fieldName]);
        })
      }, rest));
    });
    return _objectSpread(_objectSpread({}, acc), {}, (0, _defineProperty2.default)({}, fieldName, adaptedFacet));
  }, {});
}

function limitTo100pages(totalPages) {
  // We limit this to 100 pages since App Search currently cannot page past 100 pages
  return Math.min(totalPages, 100);
}

function adaptResponse(response) {
  var options = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};
  var facets = response.info.facets;
  var requestId = response.info.meta.request_id;
  var totalPages = response.info.meta.page && typeof response.info.meta.page.total_pages !== "undefined" ? limitTo100pages(response.info.meta.page.total_pages) : undefined;
  var totalResults = response.info.meta.page ? response.info.meta.page.total_results : undefined;
  return _objectSpread(_objectSpread(_objectSpread({}, facets && {
    facets: adaptFacets(facets, options)
  }), {}, {
    rawResponse: response,
    requestId: requestId,
    results: response.rawResults
  }, totalPages !== undefined && {
    totalPages: totalPages
  }), totalResults !== undefined && {
    totalResults: totalResults
  });
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uL3NyYy9yZXNwb25zZUFkYXB0ZXIuanMiXSwibmFtZXMiOlsiYWRhcHRhdGlvbjFBZGFwdEZhY2V0VmFsdWUiLCJmYWNldFZhbHVlIiwiYWRkaXRpb25hbEZhY2V0VmFsdWVGaWVsZHNGb3JGaWVsZCIsImhhc1ZhbHVlIiwiaGFzT3duUHJvcGVydHkiLCJjb3VudCIsInZhbHVlIiwicmVzdCIsImFkYXB0YXRpb24yQWRkTGFiZWxUb0ZhY2V0IiwiZmllbGROYW1lIiwiZmFjZXQiLCJmaWVsZCIsImFkYXB0RmFjZXRzIiwiZmFjZXRzIiwiYWRkaXRpb25hbEZhY2V0VmFsdWVGaWVsZHMiLCJPYmplY3QiLCJrZXlzIiwibGVuZ3RoIiwiZW50cmllcyIsInJlZHVjZSIsImFjYyIsImFkYXB0ZWRGYWNldCIsIm1hcCIsInYiLCJ0eXBlIiwiZGF0YSIsImYiLCJsaW1pdFRvMTAwcGFnZXMiLCJ0b3RhbFBhZ2VzIiwiTWF0aCIsIm1pbiIsImFkYXB0UmVzcG9uc2UiLCJyZXNwb25zZSIsIm9wdGlvbnMiLCJpbmZvIiwicmVxdWVzdElkIiwibWV0YSIsInJlcXVlc3RfaWQiLCJwYWdlIiwidG90YWxfcGFnZXMiLCJ1bmRlZmluZWQiLCJ0b3RhbFJlc3VsdHMiLCJ0b3RhbF9yZXN1bHRzIiwicmF3UmVzcG9uc2UiLCJyZXN1bHRzIiwicmF3UmVzdWx0cyJdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQUFBLFNBQVNBLDBCQUFULENBQ0VDLFVBREYsRUFHRTtBQUFBLE1BREFDLGtDQUNBLHVFQURxQyxFQUNyQztBQUNBLE1BQU1DLFFBQVEsR0FBR0YsVUFBVSxDQUFDRyxjQUFYLENBQTBCLE9BQTFCLENBQWpCO0FBREEsTUFFUUMsS0FGUixHQUVrQ0osVUFGbEMsQ0FFUUksS0FGUjtBQUFBLE1BRWVDLEtBRmYsR0FFa0NMLFVBRmxDLENBRWVLLEtBRmY7QUFBQSxNQUV5QkMsSUFGekIsMENBRWtDTixVQUZsQztBQUdBLFNBQU87QUFDTEksSUFBQUEs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TWpCLFVBQVUsS0FBS1ksU0FBZixJQUE0QjtBQUFFWixJQUFBQSxVQUFVLEVBQVZBO0FBQUYsR0FMbEMsR0FNTWEsWUFBWSxLQUFLRCxTQUFqQixJQUE4QjtBQUFFQyxJQUFBQSxZQUFZLEVBQVpBO0FBQUYsR0FOcEM7QUFRRCIsInNvdXJjZXNDb250ZW50IjpbImZ1bmN0aW9uIGFkYXB0YXRpb24xQWRhcHRGYWNldFZhbHVlKFxuICBmYWNldFZhbHVlLFxuICBhZGRpdGlvbmFsRmFjZXRWYWx1ZUZpZWxkc0ZvckZpZWxkID0ge31cbikge1xuICBjb25zdCBoYXNWYWx1ZSA9IGZhY2V0VmFsdWUuaGFzT3duUHJvcGVydHkoXCJ2YWx1ZVwiKTtcbiAgY29uc3QgeyBjb3VudCwgdmFsdWUsIC4uLnJlc3QgfSA9IGZhY2V0VmFsdWU7XG4gIHJldHVybiB7XG4gICAgY291bnQsXG4gICAgdmFsdWU6IGhhc1ZhbHVlXG4gICAgICA/IHZhbHVlXG4gICAgICA6IHtcbiAgICAgICAgICAuLi5yZXN0LFxuICAgICAgICAgIC4uLmFkZGl0aW9uYWxGYWNldFZhbHVlRmllbGRzRm9yRmllbGRcbiAgICAgICAgfVxuICB9O1xufVxuXG5mdW5jdGlvbiBhZGFwdGF0aW9uMkFkZExhYmVsVG9GYWNldChmaWVsZE5hbWUsIGZhY2V0KSB7XG4gIHJldHVybiB7XG4gICAgZmllbGQ6IGZpZWxkTmFtZSxcbiAgICAuLi5mYWNldFxuICB9O1xufVxuXG5mdW5jdGlvbiBhZGFwdEZhY2V0cyhmYWNldHMsIHsgYWRkaXRpb25hbEZhY2V0VmFsdWVGaWVsZHMgPSB7fSB9KSB7XG4gIGlmICghZmFjZXRzIHx8IE9iamVjdC5rZXlzKGZhY2V0cykubGVuZ3RoID09PSAwKSByZXR1cm4gZmFjZXRzO1xuXG4gIHJldHVybiBPYmplY3QuZW50cmllcyhmYWNldHMpLnJlZHVjZSgoYWNjLCBbZmllbGROYW1lLCBmYWNldF0pID0+IHtcbiAgICBjb25zdCBhZGFwdGVkRmFjZXQgPSBmYWNldC5tYXAodiA9PiB7XG4gICAgICBjb25zdCB7IHR5cGUsIGRhdGEsIC4uLnJlc3QgfSA9IHY7XG4gICAgICByZXR1cm4gYWRhcHRhdGlvbjJBZGRMYWJlbFRvRmFjZXQoZmllbGROYW1lLCB7XG4gICAgICAgIHR5cGUsXG4gICAgICAgIGRhdGE6IGRhdGEubWFwKGYgPT5cbiAgICAgICAgICBhZGFwdGF0aW9uMUFkYXB0RmFjZXRWYWx1ZShmLCBhZGRpdGlvbmFsRmFjZXRWYWx1ZUZpZWxkc1tmaWVsZE5hbWVdKVxuICAgICAgICApLFxuICAgICAgICAuLi5yZXN0XG4gICAgICB9KTtcbiAgICB9KTtcblxuICAgIHJldHVybiB7XG4gICAgICAuLi5hY2MsXG4gICAgICBbZmllbGROYW1lXTogYWRhcHRlZEZhY2V0XG4gICAgfTtcbiAgfSwge30pO1xufVxuXG5mdW5jdGlvbiBsaW1pdFRvMTAwcGFnZXModG90YWxQYWdlcykge1xuICAvLyBXZSBsaW1pdCB0aGlzIHRvIDEwMCBwYWdlcyBzaW5jZSBBcHAgU2VhcmNoIGN1cnJlbnRseSBjYW5ub3QgcGFnZSBwYXN0IDEwMCBwYWdlc1xuICByZXR1cm4gTWF0aC5taW4odG90YWxQYWdlcywgMTAwKTtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGFkYXB0UmVzcG9uc2UocmVzcG9uc2UsIG9wdGlvbnMgPSB7fSkge1xuICBjb25zdCBmYWNldHMgPSByZXNwb25zZS5pbmZvLmZhY2V0cztcbiAgY29uc3QgcmVxdWVzdElkID0gcmVzcG9uc2UuaW5mby5tZXRhLnJlcXVlc3RfaWQ7XG5cbiAgY29uc3QgdG90YWxQYWdlcyA9XG4gICAgcmVzcG9uc2UuaW5mby5tZXRhLnBhZ2UgJiZcbiAgICB0eXBlb2YgcmVzcG9uc2UuaW5mby5tZXRhLnBhZ2UudG90YWxfcGFnZXMgIT09IFwidW5kZWZpbmVkXCJcbiAgICAgID8gbGltaXRUbzEwMHBhZ2VzKHJlc3BvbnNlLmluZm8ubWV0YS5wYWdlLnRvdGFsX3BhZ2VzKVxuICAgICAgOiB1bmRlZmluZWQ7XG5cbiAgY29uc3QgdG90YWxSZXN1bHRzID0gcmVzcG9uc2UuaW5mby5tZXRhLnBhZ2VcbiAgICA/IHJlc3BvbnNlLmluZm8ubWV0YS5wYWdlLnRvdGFsX3Jlc3VsdHNcbiAgICA6IHVuZGVmaW5lZDtcblxuICByZXR1cm4ge1xuICAgIC4uLihmYWNldHMgJiYgeyBmYWNldHM6IGFkYXB0RmFjZXRzKGZhY2V0cywgb3B0aW9ucykgfSksXG4gICAgcmF3UmVzcG9uc2U6IHJlc3BvbnNlLFxuICAgIHJlcXVlc3RJZCxcbiAgICByZXN1bHRzOiByZXNwb25zZS5yYXdSZXN1bHRzLFxuICAgIC4uLih0b3RhbFBhZ2VzICE9PSB1bmRlZmluZWQgJiYgeyB0b3RhbFBhZ2VzIH0pLFxuICAgIC4uLih0b3RhbFJlc3VsdHMgIT09IHVuZGVmaW5lZCAmJiB7IHRvdGFsUmVzdWx0cyB9KVxuICB9O1xufVxuIl19